

<button id="create-test-button" class="btn btn-default" ng-click="isCollapsed = !isCollapsed">
    Create Test
    <i class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': !isCollapsed, 'glyphicon-chevron-right': isCollapsed}"></i>
</button>

<button id="create-test-button" class="btn btn-default" ng-click="configCollapsed = !configCollapsed">
    Configure 
    <span class="pull-right fui-gear"></span>
</button>

<hr>

<div collapse="configCollapsed">
  <div class="well well-lg">
    <form name="settingsForm" class="form-inline">

      <input class="form-control" type="text" name="smtp" ng-model="settingsData.smtp" placeholder="SMTP Server" />

      <input class="form-control" type="text" name="tenant" ng-model="settingsData.email" placeholder="Email addresses" />


      <button class="btn btn-success" ng-click="saveSettings(settingsData)">
        Save Settings
      </button>        

    </form>
  </div> 
</div>

<div collapse="isCollapsed">
  <div class="well well-lg">
    <form name="testForm" class="form-inline" ng-submit="createTest()" novalidate>

      <input 
        ng-model="testData.phone_number" 
        ng-pattern="/^\+\d+$/"
        ng-minlength="12"
        ng-maxlenght="15"
        class="form-control" 
        type="text" 
        name="phone_number" 
        placeholder="Phone Number" 
        required
        tooltip="Phone number must start with + sign and be at least 11 digits"  
        tooltip-trigger="focus" 
        tooltip-placement="top"
      />

      <input 
        ng-model="testData.tenant" 
        ng-minlength="2"
        class="form-control" 
        type="text" 
        name="tenant" 
        placeholder="Tenant" 
        required
        typeahead="tenant for tenant in tenants |filter:$viewValue |limitTo:8"
        typeahead-editable="false"
      />

      <input 
        ng-model="testData.mcp" 
        ng-pattern="/^.*\..*$/"
        ng-minlenght="6"
        class="form-control" 
        type="text" 
        name="mcp"
        placeholder="MCP" 
        required
        tooltip="FQDN or IP address"
        tooltip-trigger="focus"
        tooltip-placement="top"
      />

      <button 
        class="btn btn-success" 
        type="submit" 
        ng-disabled="testForm.$invalid"
      >
        Create Test
      </button>        

    </form>
  </div> 
</div>

<div class="well">
<form class="form-inline">
  <input class="form-control" type="text" ng-model="searchTests" placeholder="Search tests..." />
  <button class="btn btn-info" ng-click="copySearchTests()">
    clear
  </button>
</form>

<br>

<div class="table-responsive">
  <table class="table table-striped">

    <thead>
      <tr>
        <td><center><b>Errors</b></center></td>
        <td><b>Phone Number</b></td>
        <td><b>Tenant</b></td>
        <td><b>MCP</b></td>
      </tr>
    </thead>

    <tbody>
      <tr ng-repeat="test in tests |orderBy:'status':true |filter:searchTests">
        
        <td>
          <center>
          <span class="badge" ng-class="{'badge-danger': test.status > 0, 'badge-success': test.status == 0}">
            {{ test.status }}
          </span>
        </center>
        </td>
        
        <td class="pointer" ng-click="copySearchTests(test.phone_number, test.id)">
          {{ test.phone_number }} 
        </td>
        
        <td id="tenant-column" class="pointer" ng-click="copySearchTests(test.tenant.name)"> 
          {{ test.tenant.name }}
        </td>

        <td class="pointer" ng-click="copySearchTests(test.mcp.ip_address); resultsFaded = !resultsFaded">
          {{ test.mcp.ip_address }}
        </td>

        <td>

            <button id="show-results" class="btn btn-success" ng-click="copySearchTests(test.phone_number); showHide(test.id)" ng-show="!showResults">
              show results
              <span class="glyphicon glyphicon-chevron-right pull-right">
            </button>

            <button id="show-results" class="btn btn-success" ng-click="copySearchTests()" ng-show="showResults">
              hide results
              <span class="glyphicon glyphicon-chevron-down pull-right">
            </button>
        </td>


        <td>
          <button class="btn btn-success btn-condensed" ng-click="copyTest(test)">
            copy
          </button>
  
            <button class="btn btn-danger" ng-click="delete(test.id)">delete</button>
        </td>
      </tr>
    </tbody>
  </table>
</div>
</div>

<div ng-show="spinner"><center><img src="/assets/ajax-loader.gif"></center></div>

<div transition="fade" do-it="resultsFaded">

<div class="well">
  <div>
  <div class="form-inline pull-left">
    <input class="form-control" type="text" ng-model="searchResults" placeholder="Search results..." />
    <button class="btn btn-info" ng-click="copySearchResults()">
      clear
    </button>
  </div>
<div class="pagination pull-right pagination-margin">
<pagination 
  total-items="totalItems" 
  page="currentPage" 
  class="pointer" 
  boundary-links="true" 
  rotate="true"
  max-size="5"
></pagination>
</div>
</div>
  <br> 
  <div id="wavesurfer"></div>

  <table class="table table-striped">

    <thead>
      <tr>
        <td><b>Log</b></td>
        <td><b>When?</b></td>
      </tr>
    </thead>

    <tbody>
      <tr ng-repeat="result in filteredResults |filter:searchResults |orderBy:'updated_at':true |startFrom:(currentPage-1)*pageSize |limitTo:pageSize" on-finish-render>
        <td>
          <p style="white-space: pre;"><small>{{ result.log }}</small></p>
          <div id="wavesurfer{{ result.id }}" class="wave-background"></div>

        </td>

        <td> 
          {{ result.time_ago }} ago
        </td>

      </tr>
    </tbody>
  </table>
</div>
</div>